<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Test</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        canvas {
            max-height: 300px;
        }
    </style>
</head>
<body>
    <h1>Dashboard API Test</h1>

    <div class="test-section">
        <h2>API Status Check</h2>
        <div id="api-status">Checking...</div>
    </div>

    <div class="test-section">
        <h2>Model Quality Chart Test</h2>
        <canvas id="modelQualityChart"></canvas>
        <div id="model-status"></div>
    </div>

    <div class="test-section">
        <h2>Temporal Performance Chart Test</h2>
        <canvas id="temporalChart"></canvas>
        <div id="temporal-status"></div>
    </div>

    <script>
        async function testAPIs() {
            const statusDiv = document.getElementById('api-status');
            const results = [];

            const endpoints = [
                '/api/overview',
                '/api/model-quality-scores',
                '/api/temporal-performance',
                '/api/quality-trends',
                '/api/skills',
                '/api/agents'
            ];

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(`http://localhost:5000${endpoint}`);
                    const data = await response.json();
                    results.push(`<div class="status success">✅ ${endpoint} - OK</div>`);

                    // Store data for charts
                    if (endpoint === '/api/model-quality-scores') {
                        window.modelData = data;
                        createModelChart(data);
                    } else if (endpoint === '/api/temporal-performance') {
                        window.temporalData = data;
                        createTemporalChart(data);
                    }
                } catch (error) {
                    results.push(`<div class="status error">❌ ${endpoint} - Error: ${error.message}</div>`);
                }
            }

            statusDiv.innerHTML = results.join('');
        }

        function createModelChart(data) {
            const ctx = document.getElementById('modelQualityChart').getContext('2d');
            const statusDiv = document.getElementById('model-status');

            try {
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: data.models,
                        datasets: [{
                            label: 'Quality Score',
                            data: data.quality_scores,
                            backgroundColor: ['#667eea', '#10b981', '#f59e0b', '#ef4444']
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100
                            }
                        }
                    }
                });
                statusDiv.innerHTML = '<div class="status success">✅ Model chart created successfully</div>';
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">❌ Chart error: ${error.message}</div>`;
            }
        }

        function createTemporalChart(data) {
            const ctx = document.getElementById('temporalChart').getContext('2d');
            const statusDiv = document.getElementById('temporal-status');

            try {
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.labels || ['Day 1', 'Day 2', 'Day 3'],
                        datasets: [{
                            label: 'Performance Score',
                            data: data.performance_scores || [85, 88, 92],
                            borderColor: '#667eea',
                            tension: 0.4
                        }, {
                            label: 'Contribution',
                            data: data.contribution_scores || [25, 27, 30],
                            borderColor: '#10b981',
                            tension: 0.4,
                            yAxisID: 'y1'
                        }]
                    },
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                beginAtZero: true,
                                max: 100,
                                position: 'left'
                            },
                            y1: {
                                beginAtZero: true,
                                max: 50,
                                position: 'right',
                                grid: {
                                    drawOnChartArea: false
                                }
                            }
                        }
                    }
                });
                statusDiv.innerHTML = '<div class="status success">✅ Temporal chart created successfully</div>';
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">❌ Chart error: ${error.message}</div>`;
            }
        }

        // Run tests when page loads
        window.onload = function() {
            testAPIs();
        };
    </script>
</body>
</html>